{%- if section.settings.preload -%}
    {{ 'section-promotion-banner.css' | asset_url | stylesheet_tag: preload: true }}
{%- else -%}
    {{ 'section-promotion-banner.css' | asset_url | stylesheet_tag }}
{%- endif -%}


{% for product in section.settings.product_list %}
    {% if canonical_url contains product.handle %}
        <style>
        .promotion-banner__section[data-id="{{ section.id }}"] {
            display:block;
        }
        </style>
    {% endif %}
{% endfor %}
{% for collection in section.settings.collection_list %}
    {% if canonical_url contains collection.handle %}
        <style>
        .promotion-banner__section[data-id="{{ section.id }}"] {
            display:block;
        }
        </style>
    {% endif %}
{% endfor %}

    {% if section.settings.cta_link == 'none' %}
        <section id="{{ section.settings.section-id }}" data-id="{{ section.id }}" class="promotion-banner__section{% if section.settings.hide %} promotion-banner__section--hidden{% endif %}">
            {%- if section.settings.title-above != blank -%}
                <h2 class="promotion-banner__title">{{- section.settings.title-above | escape -}}</h2>
            {%- endif -%}
            <div class="promotion-banner__content">
                {{- section.settings.main-text -}}
            </div>
        </section>
    {% elsif section.settings.cta_link == 'wrap' %}
        <a class="promotion-banner__link" href="{{ section.settings.cta_url }}">
            <section id="{{ section.settings.section-id }}" data-id="{{ section.id }}" class="promotion-banner__section{% if section.settings.hide %} promotion-banner__section--hidden{% endif %}">
            {%- if section.settings.title-above != blank -%}
                    <h2 class="promotion-banner__title">{{- section.settings.title-above | escape -}}</h2>
                {%- endif -%}
                <div class="promotion-banner__content">
                    {{- section.settings.main-text -}}
                </div>
                
            </section>
        </a>
    {% elsif section.settings.cta_link == 'cta' %}
        <section id="{{ section.settings.section-id }}" data-id="{{ section.id }}" class="promotion-banner__section{% if section.settings.hide %} promotion-banner__section--hidden{% endif %}">
            {%- if section.settings.title-above != blank -%}
                <h2 class="promotion-banner__title">{{- section.settings.title-above | escape -}}</h2>
            {%- endif -%}
            <div class="promotion-banner__content">
                {{- section.settings.main-text -}}
            </div>
            <a class="button button--secondary" 
            style="
                background: {{ section.settings.cta_background }};
                color: {{ section.settings.cta_color }};"
            href="{{ section.settings.cta_url }}"><span>{{ section.settings.cta_text }}</span></a>
        </section>
    {% endif %}


<style>
    .promotion-banner__section[data-id="{{ section.id }}"] {
        --background: {{ section.settings.background }};
        --color: {{ section.settings.text-color }};
        --bold-bg: {{ section.settings.bold-text-background }};
    }
</style>

{% schema %}
    {
        "name": "Promotional Banner",
        "class": "shopify-section--promotion-banner",
        "settings": [
            {
                "type": "checkbox",
                "id": "preload",
                "label": "Preload section styles",
                "default": true,
                "info": "Enable when the section is visible on page load (above the fold) for better performance"
            },
            {
                "type": "color",
                "id": "background",
                "label": "Background color",
                "default": "#f7f177"
            },
            {
                "type": "color",
                "id": "text-color",
                "label": "Text color",
                "default": "#000"
            },
            {
                "type": "color",
                "id": "bold-text-background",
                "label": "Bold text background",
                "default": "#fff"
            },
            {
                "type": "text",
                "id": "title-above",
                "label": "Upper title"
            },
            {
                "type": "richtext",
                "id": "main-text",
                "label": "Main text"
            },
            {
                "type":"header",
                "content": "Display rules",
                "info": "Collection and product rules will override hide by default checkbox rule, this will work as expected if hiding checkbox is checked"
            },
            {
                "type": "checkbox",
                "id": "hide",
                "label": "Hide by default",
                "default": true,
                "info": "This will hide the banner site wide except for the display rules defined below"
            },
            {
                "type": "product_list",
                "id": "product_list",
                "label": "Products",
                "limit": 20,
                "info": "Ignore this setting if you are in collection template. This setting only applies if this section is in the product template."
            },
            {
                "type": "collection_list",
                "id": "collection_list",
                "label": "Collections",
                "limit": 20,
                "info": "Ignore this setting if you are in product template. This setting only applies if this section is in the collection template"
            },
            {
                "type": "text",
                "id": "section-id",
                "label": "Section ID",
                "info": "Used to target this section with Google Optimize. Use a unique identifier, do not leave this blank."
            },
            {
                "type": "select",
                "id": "cta_link",
                "label": "Banner link type",
                "options": [
                    {
                        "value": "wrap",
                        "label": "Whole banner"
                    },
                    {
                        "value": "cta",
                        "label": "Use CTA"
                    },
                    {
                        "value": "none",
                        "label": "None"
                    }
                ],
                "default": "none"
            },
            {
                "type": "url",
                "id": "cta_url",
                "label": "Link url"
            },
            {
            "type": "text",
            "id": "cta_text",
            "label": "CTA label",
            "default": "Click here"
            },
            {
                "type": "color",
                "id": "cta_color",
                "label": "CTA text color",
                "default": "#000"
            },
            {
                "type": "color",
                "id": "cta_background",
                "label": "CTA background",
                "default": "#fff"
            }
        ],
        "presets": [
            {
                "name": "Promotional Banner"
            }
        ]
    }
{% endschema %}